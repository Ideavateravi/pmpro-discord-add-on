jQuery(document).ready(function(a){function n(c,g){var d=g.draggable;a(this).append(d);a('*[data-drop-role_id="'+d.data("role_id")+'"]').attr("data-drop-role_id","");var b=JSON.parse(localStorage.getItem("mapArray"))||[];a.each(b,function(l,h){if(h){var e=h.split(",");e[0]!="level_id_"+d.data("level_id")&&e[1]!=d.data("role_id")||delete b[l]}});var f="{";a.each(b,function(l,h){if(h){var e=h.split(",");if(e[0]!="level_id_"+d.data("level_id")||e[1]!=d.data("role_id"))f=f+'"'+e[0]+'":"'+e[1]+'",'}});
localStorage.setItem("mapArray",JSON.stringify(b));","==f.slice(-1)&&(f=f.slice(0,-1));var k=f+"}";a("#maaping_json_val").html(k);localStorage.setItem("mappingjson",k);d.css({width:"100%",left:"0",top:"0","margin-bottom":"10px"})}function p(c,g){var d=g.draggable;a('*[data-drop-role_id="'+d.data("role_id")+'"]').attr("data-drop-role_id","");if(a(this).data("drop-role_id")!=d.data("role_id")){var b=JSON.parse(localStorage.getItem("mapArray"))||[];a(this).attr("data-drop-role_id",d.data("role_id"));
d.attr("data-level_id",a(this).data("level_id"));a.each(b,function(l,h){if(h){var e=h.split(",");e[0]!="level_id_"+a(this).data("level_id")&&e[1]!=d.data("role_id")||delete b[l]}});var f="level_id_"+a(this).data("level_id");b.push(f+","+d.data("role_id"));var k="{";a.each(b,function(l,h){if(h){var e=h.split(",");if(e[0]=="level_id_"+a(this).data("level_id")||e[1]!=d.data("role_id")&&e[0]!="level_id_"+a(this).data("level_id")||e[1]==d.data("role_id"))k=k+'"'+e[0]+'":"'+e[1]+'",'}});localStorage.setItem("mapArray",
JSON.stringify(b));","==k.slice(-1)&&(k=k.slice(0,-1));f=k+"}";localStorage.setItem("mappingjson",f);a("#maaping_json_val").html(f)}a(this).append(g.draggable);a(this).find("span").css({order:"2"});d.css({width:"100%",left:"0",top:"0","margin-bottom":"0px",order:"1"})}a(".ets_tablinks").on("click",function(){a(".ets_tabcontent").each(function(){a(this).css({display:"none"})});a(".ets_tablinks").each(function(){a(this).removeClass("active")});a(this).addClass("active");var c=a(this).data("event");
a("#"+c).css({display:"block"});localStorage.setItem("activeTab",a(this).data("identity"))});var m=localStorage.getItem("activeTab");m?a('.ets-tabs button[data-identity="'+m+'"]').trigger("click"):a('.ets-tabs button[data-identity="settings"]').trigger("click");a("#disconnect-discord").on("click",function(c){c.preventDefault();c=a(this).data("user-id");a.ajax({type:"POST",dataType:"JSON",url:etsPmproParams.admin_ajax,data:{action:"disconnect_from_discord",user_id:c},beforeSend:function(){a(".ets-spinner").addClass("ets-is-active")},
success:function(g){1==g.status&&(window.location=window.location.href.split("?")[0])},error:function(g){alert("Server error")}})});a.ajax({type:"POST",dataType:"JSON",url:etsPmproParams.admin_ajax,data:{action:"load_discord_roles"},beforeSend:function(){a(".discord-roles .spinner").addClass("is-active")},success:function(c){c.hasOwnProperty("code")&&50001==c.code&&"Missing Access"==c.message?a(".btn-connect-to-bot").show():"401: Unauthorized"==c.message||c.hasOwnProperty("code")?a("#connect-discord-bot").show().html("Error: Please check all details are correct").addClass("error-bk"):
a("#connect-discord-bot").show().html("Bot Connected <i class='fab fa-discord'></i>").addClass("not-active");a.each(c,function(d,b){var f=!1;b.hasOwnProperty("tags")&&b.tags.hasOwnProperty("bot_id")&&(f=!0);"previous_mapping"!=d&&0==f&&"@everyone"!=b.name&&(a(".discord-roles").append('<div class="makeMeDraggable" data-role_id="'+b.id+'" >'+b.name+"</div>"),a("#defaultRole").append('<option value="'+b.id+'" >'+b.name+"</option>"),a(".makeMeDraggable").draggable({revert:"invalid"}))});var g=a("#selected_default_role").val();
g&&a("#defaultRole option[value="+g+"]").prop("selected",!0);c=c.previous_mapping?c.previous_mapping:localStorage.getItem("mappingjson");a("#maaping_json_val").html(c);a.each(JSON.parse(c),function(d,b){var f=d.split("id_");a('*[data-level_id="'+f[1]+'"]').append(a('*[data-role_id="'+b+'"]')).attr("data-drop-role_id",b).find("span").css({order:"2"});a('*[data-role_id="'+b+'"]').css({width:"100%",left:"0",top:"0","margin-bottom":"0px",order:"1"}).attr("data-level_id",f[1])})},complete:function(){a(".discord-roles .spinner").removeClass("is-active").css({"float":"right"})}});
a("#clrbtn").click(function(c){c.preventDefault();a.ajax({url:etsPmproParams.admin_ajax,type:"POST",data:"action=ets_clear_logs&",beforeSend:function(){a(".spinner").addClass("is-active").show()},success:function(g){g.error?alert(g.error.msg):a(".error-log").html("Clear logs Sucesssfully !")},complete:function(){a(".spinner").removeClass("is-active").hide()}})});a("#revertMapping").on("click",function(){localStorage.removeItem("mapArray");localStorage.removeItem("mappingjson");location.reload(!0)});
a(function(){a(".makeMeDroppable").droppable({drop:p,hoverClass:"hoverActive"});a(".discord-roles-col").droppable({drop:n,hoverClass:"hoverActive"})})});